<div style="max-width: 100%; margin: auto; background: #fff0f5; padding: 16px; border-radius: 10px; box-sizing: border-box;">
  <label>初始本金（美元）</label>
  <input type="number" id="initial" value="100" style="width:100%; padding:12px; margin-bottom:12px; font-size:16px;" />

  <label>每日收益率</label>
  <input type="number" id="rate" value="0.0005" readonly style="width:100%; padding:12px; margin-bottom:12px; font-size:16px; background-color:#eee;" />

  <label>杠杆倍数</label>
  <input type="number" id="leverage" value="11" readonly style="width:100%; padding:12px; margin-bottom:12px; font-size:16px; background-color:#eee;" />

  <label>期望每日返利金额（美元）</label>
  <input type="number" id="target" value="100" style="width:100%; padding:12px; margin-bottom:12px; font-size:16px;" />

  <button onclick="calculate()" style="width:100%; background:#00cc66; color:white; padding:12px; font-size:18px; border:none; border-radius:5px;">计算</button>

  <div id="output" style="margin-top: 20px;"></div>
</div>

<script>
function calculate() {
  let initial = parseFloat(document.getElementById("initial").value);
  let rate = parseFloat(document.getElementById("rate").value);
  let leverage = parseFloat(document.getElementById("leverage").value);
  let targetReturn = parseFloat(document.getElementById("target").value);

  let capital = initial * leverage;
  let totalReturn = 0;
  let reinvests = 0;
  let days = 0;
  let logRows = [];
  let cumulativeReturn = 0;
  let today = new Date();

  while (capital * rate < targetReturn) {
    days++;
    let date = new Date(today);
    date.setDate(today.getDate() + days);

    let dailyReturn = capital * rate;
    totalReturn += dailyReturn;
    cumulativeReturn += dailyReturn;
    capital -= dailyReturn;

    let reinvestNow = false;
    let reinvestAmount = 0;
    if (totalReturn >= 100) {
      reinvestNow = true;
      reinvestAmount = totalReturn;
      capital += totalReturn * leverage;
      totalReturn = 0;
      reinvests++;
    }

    logRows.push({
      day: days,
      date: date.toLocaleDateString(),
      return: dailyReturn,
      reinvest: reinvestNow ? `$${reinvestAmount.toFixed(2)}` : '',
      capital: capital,
      cumulativeReturn: cumulativeReturn,
      highlight: reinvestNow
    });
  }

  let resultHTML = `
    <p style="font-weight:bold; color:#333; font-size:16px;">
      首次达到每日返利 $${targetReturn.toFixed(2)} 需要 ${days} 天，共复投 ${reinvests} 次。
    </p>
    <div style="overflow-x:auto; border:1px solid #ccc; max-height:400px;">
      <table border="1" cellpadding="6" cellspacing="0" style="width:100%; font-size:14px; border-collapse: collapse; background:white; min-width:600px;">
        <thead style="position: sticky; top: 0; background: #f0f0f0;">
          <tr>
            <th>天数</th>
            <th>日期</th>
            <th>当天返利</th>
            <th>累计返利</th>
            <th>是否复投</th>
            <th>当前本金</th>
          </tr>
        </thead>
        <tbody>
          ${logRows.map(row => `
            <tr style="${row.highlight ? 'color:red; font-weight:bold;' : ''}">
              <td>${row.day}</td>
              <td>${row.date}</td>
              <td>$${row.return.toFixed(2)}</td>
              <td>$${row.cumulativeReturn.toFixed(2)}</td>
              <td>${row.reinvest}</td>
              <td>$${row.capital.toFixed(2)}</td>
            </tr>
          `).join('')}
        </tbody>
      </table>
    </div>
  `;

  document.getElementById("output").innerHTML = resultHTML;
}
</script>
